{"ast":null,"code":"/**\n * Socket event handling utilities for handling events on either\n * WebSocket and TCP sockets\n *\n * Note to anyone reviewing this code: these functions are called\n * in the context of their parent object, unless bound\n * @fileOverview\n */\n'use strict';\n\nvar decompressPng = require('../util/decompressPng');\n\nvar CBOR = require('cbor-js');\n\nvar typedArrayTagger = require('../util/cborTypedArrayTags');\n\nvar BSON = null;\n\nif (typeof bson !== 'undefined') {\n  BSON = bson().BSON;\n}\n/**\n * Events listeners for a WebSocket or TCP socket to a JavaScript\n * ROS Client. Sets up Messages for a given topic to trigger an\n * event on the ROS client.\n *\n * @namespace SocketAdapter\n * @private\n */\n\n\nfunction SocketAdapter(client) {\n  var decoder = null;\n\n  if (client.transportOptions.decoder) {\n    decoder = client.transportOptions.decoder;\n  }\n\n  function handleMessage(message) {\n    if (message.op === 'publish') {\n      client.emit(message.topic, message.msg);\n    } else if (message.op === 'service_response') {\n      client.emit(message.id, message);\n    } else if (message.op === 'call_service') {\n      client.emit(message.service, message);\n    } else if (message.op === 'status') {\n      if (message.id) {\n        client.emit('status:' + message.id, message);\n      } else {\n        client.emit('status', message);\n      }\n    }\n  }\n\n  function handlePng(message, callback) {\n    if (message.op === 'png') {\n      decompressPng(message.data, callback);\n    } else {\n      callback(message);\n    }\n  }\n\n  function decodeBSON(data, callback) {\n    if (!BSON) {\n      throw 'Cannot process BSON encoded message without BSON header.';\n    }\n\n    var reader = new FileReader();\n\n    reader.onload = function () {\n      var uint8Array = new Uint8Array(this.result);\n      var msg = BSON.deserialize(uint8Array);\n      callback(msg);\n    };\n\n    reader.readAsArrayBuffer(data);\n  }\n\n  return {\n    /**\n     * Emits a 'connection' event on WebSocket connection.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onopen: function onOpen(event) {\n      client.isConnected = true;\n      client.emit('connection', event);\n    },\n\n    /**\n     * Emits a 'close' event on WebSocket disconnection.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onclose: function onClose(event) {\n      client.isConnected = false;\n      client.emit('close', event);\n    },\n\n    /**\n     * Emits an 'error' event whenever there was an error.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onerror: function onError(event) {\n      client.emit('error', event);\n    },\n\n    /**\n     * Parses message responses from rosbridge and sends to the appropriate\n     * topic, service, or param.\n     *\n     * @param message - the raw JSON message from rosbridge.\n     * @memberof SocketAdapter\n     */\n    onmessage: function onMessage(data) {\n      if (decoder) {\n        decoder(data.data, function (message) {\n          handleMessage(message);\n        });\n      } else if (typeof Blob !== 'undefined' && data.data instanceof Blob) {\n        decodeBSON(data.data, function (message) {\n          handlePng(message, handleMessage);\n        });\n      } else if (data.data instanceof ArrayBuffer) {\n        var decoded = CBOR.decode(data.data, typedArrayTagger);\n        handleMessage(decoded);\n      } else {\n        var message = JSON.parse(typeof data === 'string' ? data : data.data);\n        handlePng(message, handleMessage);\n      }\n    }\n  };\n}\n\nmodule.exports = SocketAdapter;","map":{"version":3,"names":["decompressPng","require","CBOR","typedArrayTagger","BSON","bson","SocketAdapter","client","decoder","transportOptions","handleMessage","message","op","emit","topic","msg","id","service","handlePng","callback","data","decodeBSON","reader","FileReader","onload","uint8Array","Uint8Array","result","deserialize","readAsArrayBuffer","onopen","onOpen","event","isConnected","onclose","onClose","onerror","onError","onmessage","onMessage","Blob","ArrayBuffer","decoded","decode","JSON","parse","module","exports"],"sources":["/home/daeho/Documents/react/study/node_modules/roslib/src/core/SocketAdapter.js"],"sourcesContent":["/**\n * Socket event handling utilities for handling events on either\n * WebSocket and TCP sockets\n *\n * Note to anyone reviewing this code: these functions are called\n * in the context of their parent object, unless bound\n * @fileOverview\n */\n'use strict';\n\nvar decompressPng = require('../util/decompressPng');\nvar CBOR = require('cbor-js');\nvar typedArrayTagger = require('../util/cborTypedArrayTags');\nvar BSON = null;\nif(typeof bson !== 'undefined'){\n    BSON = bson().BSON;\n}\n\n/**\n * Events listeners for a WebSocket or TCP socket to a JavaScript\n * ROS Client. Sets up Messages for a given topic to trigger an\n * event on the ROS client.\n *\n * @namespace SocketAdapter\n * @private\n */\nfunction SocketAdapter(client) {\n\n  var decoder = null;\n  if (client.transportOptions.decoder) {\n    decoder = client.transportOptions.decoder;\n  }\n\n  function handleMessage(message) {\n    if (message.op === 'publish') {\n      client.emit(message.topic, message.msg);\n    } else if (message.op === 'service_response') {\n      client.emit(message.id, message);\n    } else if (message.op === 'call_service') {\n      client.emit(message.service, message);\n    } else if(message.op === 'status'){\n      if(message.id){\n        client.emit('status:'+message.id, message);\n      } else {\n        client.emit('status', message);\n      }\n    }\n  }\n\n  function handlePng(message, callback) {\n    if (message.op === 'png') {\n      decompressPng(message.data, callback);\n    } else {\n      callback(message);\n    }\n  }\n\n  function decodeBSON(data, callback) {\n    if (!BSON) {\n      throw 'Cannot process BSON encoded message without BSON header.';\n    }\n    var reader = new FileReader();\n    reader.onload  = function() {\n      var uint8Array = new Uint8Array(this.result);\n      var msg = BSON.deserialize(uint8Array);\n      callback(msg);\n    };\n    reader.readAsArrayBuffer(data);\n  }\n\n  return {\n    /**\n     * Emits a 'connection' event on WebSocket connection.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onopen: function onOpen(event) {\n      client.isConnected = true;\n      client.emit('connection', event);\n    },\n\n    /**\n     * Emits a 'close' event on WebSocket disconnection.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onclose: function onClose(event) {\n      client.isConnected = false;\n      client.emit('close', event);\n    },\n\n    /**\n     * Emits an 'error' event whenever there was an error.\n     *\n     * @param event - the argument to emit with the event.\n     * @memberof SocketAdapter\n     */\n    onerror: function onError(event) {\n      client.emit('error', event);\n    },\n\n    /**\n     * Parses message responses from rosbridge and sends to the appropriate\n     * topic, service, or param.\n     *\n     * @param message - the raw JSON message from rosbridge.\n     * @memberof SocketAdapter\n     */\n    onmessage: function onMessage(data) {\n      if (decoder) {\n        decoder(data.data, function (message) {\n          handleMessage(message);\n        });\n      } else if (typeof Blob !== 'undefined' && data.data instanceof Blob) {\n        decodeBSON(data.data, function (message) {\n          handlePng(message, handleMessage);\n        });\n      } else if (data.data instanceof ArrayBuffer) {\n        var decoded = CBOR.decode(data.data, typedArrayTagger);\n        handleMessage(decoded);\n      } else {\n        var message = JSON.parse(typeof data === 'string' ? data : data.data);\n        handlePng(message, handleMessage);\n      }\n    }\n  };\n}\n\nmodule.exports = SocketAdapter;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}