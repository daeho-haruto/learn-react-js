{"ast":null,"code":"/**\n * @fileOverview\n * @author Russell Toris - rctoris@wpi.edu\n */\nvar Topic = require('../core/Topic');\n\nvar Message = require('../core/Message');\n\nvar EventEmitter2 = require('eventemitter2').EventEmitter2;\n/**\n * An actionlib action client.\n *\n * Emits the following events:\n *  * 'timeout' - if a timeout occurred while sending a goal\n *  * 'status' - the status messages received from the action server\n *  * 'feedback' -  the feedback messages received from the action server\n *  * 'result' - the result returned from the action server\n *\n *  @constructor\n *  @param options - object with following keys:\n *   * ros - the ROSLIB.Ros connection handle\n *   * serverName - the action server name, like /fibonacci\n *   * actionName - the action message name, like 'actionlib_tutorials/FibonacciAction'\n *   * timeout - the timeout length when connecting to the action server\n */\n\n\nfunction ActionClient(options) {\n  var that = this;\n  options = options || {};\n  this.ros = options.ros;\n  this.serverName = options.serverName;\n  this.actionName = options.actionName;\n  this.timeout = options.timeout;\n  this.omitFeedback = options.omitFeedback;\n  this.omitStatus = options.omitStatus;\n  this.omitResult = options.omitResult;\n  this.goals = {}; // flag to check if a status has been received\n\n  var receivedStatus = false; // create the topics associated with actionlib\n\n  this.feedbackListener = new Topic({\n    ros: this.ros,\n    name: this.serverName + '/feedback',\n    messageType: this.actionName + 'Feedback'\n  });\n  this.statusListener = new Topic({\n    ros: this.ros,\n    name: this.serverName + '/status',\n    messageType: 'actionlib_msgs/GoalStatusArray'\n  });\n  this.resultListener = new Topic({\n    ros: this.ros,\n    name: this.serverName + '/result',\n    messageType: this.actionName + 'Result'\n  });\n  this.goalTopic = new Topic({\n    ros: this.ros,\n    name: this.serverName + '/goal',\n    messageType: this.actionName + 'Goal'\n  });\n  this.cancelTopic = new Topic({\n    ros: this.ros,\n    name: this.serverName + '/cancel',\n    messageType: 'actionlib_msgs/GoalID'\n  }); // advertise the goal and cancel topics\n\n  this.goalTopic.advertise();\n  this.cancelTopic.advertise(); // subscribe to the status topic\n\n  if (!this.omitStatus) {\n    this.statusListener.subscribe(function (statusMessage) {\n      receivedStatus = true;\n      statusMessage.status_list.forEach(function (status) {\n        var goal = that.goals[status.goal_id.id];\n\n        if (goal) {\n          goal.emit('status', status);\n        }\n      });\n    });\n  } // subscribe the the feedback topic\n\n\n  if (!this.omitFeedback) {\n    this.feedbackListener.subscribe(function (feedbackMessage) {\n      var goal = that.goals[feedbackMessage.status.goal_id.id];\n\n      if (goal) {\n        goal.emit('status', feedbackMessage.status);\n        goal.emit('feedback', feedbackMessage.feedback);\n      }\n    });\n  } // subscribe to the result topic\n\n\n  if (!this.omitResult) {\n    this.resultListener.subscribe(function (resultMessage) {\n      var goal = that.goals[resultMessage.status.goal_id.id];\n\n      if (goal) {\n        goal.emit('status', resultMessage.status);\n        goal.emit('result', resultMessage.result);\n      }\n    });\n  } // If timeout specified, emit a 'timeout' event if the action server does not respond\n\n\n  if (this.timeout) {\n    setTimeout(function () {\n      if (!receivedStatus) {\n        that.emit('timeout');\n      }\n    }, this.timeout);\n  }\n}\n\nActionClient.prototype.__proto__ = EventEmitter2.prototype;\n/**\n * Cancel all goals associated with this ActionClient.\n */\n\nActionClient.prototype.cancel = function () {\n  var cancelMessage = new Message();\n  this.cancelTopic.publish(cancelMessage);\n};\n/**\n * Unsubscribe and unadvertise all topics associated with this ActionClient.\n */\n\n\nActionClient.prototype.dispose = function () {\n  this.goalTopic.unadvertise();\n  this.cancelTopic.unadvertise();\n\n  if (!this.omitStatus) {\n    this.statusListener.unsubscribe();\n  }\n\n  if (!this.omitFeedback) {\n    this.feedbackListener.unsubscribe();\n  }\n\n  if (!this.omitResult) {\n    this.resultListener.unsubscribe();\n  }\n};\n\nmodule.exports = ActionClient;","map":{"version":3,"names":["Topic","require","Message","EventEmitter2","ActionClient","options","that","ros","serverName","actionName","timeout","omitFeedback","omitStatus","omitResult","goals","receivedStatus","feedbackListener","name","messageType","statusListener","resultListener","goalTopic","cancelTopic","advertise","subscribe","statusMessage","status_list","forEach","status","goal","goal_id","id","emit","feedbackMessage","feedback","resultMessage","result","setTimeout","prototype","__proto__","cancel","cancelMessage","publish","dispose","unadvertise","unsubscribe","module","exports"],"sources":["/home/daeho/Documents/react/study/node_modules/roslib/src/actionlib/ActionClient.js"],"sourcesContent":["/**\n * @fileOverview\n * @author Russell Toris - rctoris@wpi.edu\n */\n\nvar Topic = require('../core/Topic');\nvar Message = require('../core/Message');\nvar EventEmitter2 = require('eventemitter2').EventEmitter2;\n\n/**\n * An actionlib action client.\n *\n * Emits the following events:\n *  * 'timeout' - if a timeout occurred while sending a goal\n *  * 'status' - the status messages received from the action server\n *  * 'feedback' -  the feedback messages received from the action server\n *  * 'result' - the result returned from the action server\n *\n *  @constructor\n *  @param options - object with following keys:\n *   * ros - the ROSLIB.Ros connection handle\n *   * serverName - the action server name, like /fibonacci\n *   * actionName - the action message name, like 'actionlib_tutorials/FibonacciAction'\n *   * timeout - the timeout length when connecting to the action server\n */\nfunction ActionClient(options) {\n  var that = this;\n  options = options || {};\n  this.ros = options.ros;\n  this.serverName = options.serverName;\n  this.actionName = options.actionName;\n  this.timeout = options.timeout;\n  this.omitFeedback = options.omitFeedback;\n  this.omitStatus = options.omitStatus;\n  this.omitResult = options.omitResult;\n  this.goals = {};\n\n  // flag to check if a status has been received\n  var receivedStatus = false;\n\n  // create the topics associated with actionlib\n  this.feedbackListener = new Topic({\n    ros : this.ros,\n    name : this.serverName + '/feedback',\n    messageType : this.actionName + 'Feedback'\n  });\n\n  this.statusListener = new Topic({\n    ros : this.ros,\n    name : this.serverName + '/status',\n    messageType : 'actionlib_msgs/GoalStatusArray'\n  });\n\n  this.resultListener = new Topic({\n    ros : this.ros,\n    name : this.serverName + '/result',\n    messageType : this.actionName + 'Result'\n  });\n\n  this.goalTopic = new Topic({\n    ros : this.ros,\n    name : this.serverName + '/goal',\n    messageType : this.actionName + 'Goal'\n  });\n\n  this.cancelTopic = new Topic({\n    ros : this.ros,\n    name : this.serverName + '/cancel',\n    messageType : 'actionlib_msgs/GoalID'\n  });\n\n  // advertise the goal and cancel topics\n  this.goalTopic.advertise();\n  this.cancelTopic.advertise();\n\n  // subscribe to the status topic\n  if (!this.omitStatus) {\n    this.statusListener.subscribe(function(statusMessage) {\n      receivedStatus = true;\n      statusMessage.status_list.forEach(function(status) {\n        var goal = that.goals[status.goal_id.id];\n        if (goal) {\n          goal.emit('status', status);\n        }\n      });\n    });\n  }\n\n  // subscribe the the feedback topic\n  if (!this.omitFeedback) {\n    this.feedbackListener.subscribe(function(feedbackMessage) {\n      var goal = that.goals[feedbackMessage.status.goal_id.id];\n      if (goal) {\n        goal.emit('status', feedbackMessage.status);\n        goal.emit('feedback', feedbackMessage.feedback);\n      }\n    });\n  }\n\n  // subscribe to the result topic\n  if (!this.omitResult) {\n    this.resultListener.subscribe(function(resultMessage) {\n      var goal = that.goals[resultMessage.status.goal_id.id];\n\n      if (goal) {\n        goal.emit('status', resultMessage.status);\n        goal.emit('result', resultMessage.result);\n      }\n    });\n  }\n\n  // If timeout specified, emit a 'timeout' event if the action server does not respond\n  if (this.timeout) {\n    setTimeout(function() {\n      if (!receivedStatus) {\n        that.emit('timeout');\n      }\n    }, this.timeout);\n  }\n}\n\nActionClient.prototype.__proto__ = EventEmitter2.prototype;\n\n/**\n * Cancel all goals associated with this ActionClient.\n */\nActionClient.prototype.cancel = function() {\n  var cancelMessage = new Message();\n  this.cancelTopic.publish(cancelMessage);\n};\n\n/**\n * Unsubscribe and unadvertise all topics associated with this ActionClient.\n */\nActionClient.prototype.dispose = function() {\n  this.goalTopic.unadvertise();\n  this.cancelTopic.unadvertise();\n  if (!this.omitStatus) {this.statusListener.unsubscribe();}\n  if (!this.omitFeedback) {this.feedbackListener.unsubscribe();}\n  if (!this.omitResult) {this.resultListener.unsubscribe();}\n};\n\nmodule.exports = ActionClient;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}